
<div class="full-page-container">
  <div class="table-container">
  <nz-table 
    #sortTable
    #nzTable
    [nzData]="paginatedData"
    [nzPageSize]="pageSize" 
    [nzScroll]="{  x: '1600px', y: '340px' }" 
    [nzShowPagination]="false"
  >
    <thead>
      <tr >
        <th nzStyle="background-color: #f5f5f5; color: #333;"></th>
        <th *ngFor="let column of columns"
            (click)="sortData(column.field)"
            [nzSortOrder]="column.sortDirection">
             {{ column.title }}
          <i *ngIf="column.sortDirection === 'ascend'" class="fas fa-sort-up"></i>
          <i *ngIf="column.sortDirection === 'descend'" class="fas fa-sort-down"></i>
        </th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let data of paginatedData">
        <tr>
          <td *ngIf="data.subData && data.subData.length > 0"
              [nzExpand]="expandSet.has(data.id)"
              (nzExpandChange)="onExpandChange(data.id, $event)"
          ></td>
          <!-- Si no hay subData, muestra un td vacío sin la funcionalidad de expansión -->
          <td *ngIf="!data.subData || data.subData.length === 0"></td>
          <td *ngFor="let column of columns">
            {{ data[column.field] }}
          </td>
        </tr>
        <tr *ngIf="expandSet.has(data.id) && data.subData && data.subData.length > 0">
          <td [attr.colspan]="columns.length + 1">
            <nz-table
              [nzShowPagination]="false"
              [nzBordered]="false"
              [nzData]="data.subData"
            >
              <thead>
                <tr>
                  <th *ngFor="let subColumn of subColumns">
                    {{ subColumn.title }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let subItem of data.subData">
                  <td *ngFor="let subColumn of subColumns">
                    {{ subItem[subColumn.field] }}
                  </td>
                </tr>
              </tbody>
            </nz-table>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </nz-table>
</div>


<div class="paginator-container">
  <nz-pagination 
    [nzPageSize]="pageSize"
    [nzTotal]="sortedData.length"
    [(nzPageIndex)]="currentPage"
    [nzShowTotal]="totalTemplate"
    (nzPageIndexChange)="onPageChange($event)">
  </nz-pagination>
  
  <ng-template #totalTemplate let-total>
    Registros mostrados {{ (currentPage - 1) * pageSize + 1 }} - 
    {{ (currentPage * pageSize) < total ? (currentPage * pageSize) : total }} 
    de {{ total }} registros
  </ng-template>
  
  </div>
</div>

